<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.min.css" />
    <title>GIFtastic</title>
</head>

<body>
    <div class="row">
        <div class="col-lg-12 m-3" id="savedTerm">Column for search ids</div>
    </div>
    <div class="row">
        <div class="col-lg-9 m-2">
            <div id="gifBox" class="float-left mt-3"></div>
        </div>
        <div class="col-sm-3 m-2">
            <label for="Search" class="font-weight-bold">Search Term:</label>
            <input type="text" id="searchTerm" class="w-100">
            <button type="button" id="searchButton" class="btn btn-info btn-sm mt-3">Search</button>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            var topics = ["Cats", "Dogs", "LOL"];

            // separated function to append buttons to saved terms
            function addButtons() {
                for (var i = 0; i < topics.length; i++) {
                    var newButton = $("<button>");
                    newButton.addClass('btn btn-info btn-sm m-1 termSearch');
                    newButton.attr("data-name", topics[i]);
                    newButton.text(topics[i]);
                    $("#savedTerm").append(newButton);
                }
            }

            $("#searchButton").on("click", function (event) {
                // event.preventDefault();

                //Test if on click listener was causing issues
                // console.log("Test");

                //To get information from search bar
                var topic = $("#searchTerm").val().trim();
                topics.push(topic);
                addButtons();
                displayGifs();
                // return false;
            });

            function displayGifs() {
                var topic = $("#searchTerm").val().trim();
                var queryURL = "https://api.giphy.com/v1/gifs/search?q=" + topic + "&api_key=WjSOaIXp1jZ9NyPTasy7pRqV91MO4snm&limit=10";
                $.ajax({
                    url: queryURL,
                    method: "GET"
                }).then(function (response) {
                    var result = response.data;
                    $("#gifBox").empty();
                    //currently pulling results
                    console.log(result);

                    //Sets condition of only r and pg-13 pictures to load up
                    for (var i = 0; i < result.length; i++) {
                        if (result[i].rating !== "r" && result[i].rating !== "pg-13") {
                            var gifDiv = $("<div>");
                            var rating = result[i].rating;
                            var p = $("<p>").text("Rating: " + rating);
                            var topicImage = $("<img>");
                            topicImage.attr("src", result[i].images.fixed_height.url);
                            gifDiv.append(p);
                            gifDiv.append(topicImage);
                            $("#gifBox").prepend(gifDiv);
                        }
                    }
                });
            };

            //Used to pull property listed under 'data-name'
            $("body").on("click", ".termSearch", function (event) {
                var topic = $(this).attr("data-name");
                displayGifs();
                console.log("test");
            });

            //Display pictures
            // $(document).on("click", ".termSearch", displayGifs);

            // So that the page loads with buttons loaded in
            addButtons();
        });
    </script>
</body>

</html>